<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>BPM测量工具</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; text-align: center; }
        #bpm { font-size: 2.5em; margin: 30px 0; }
        #info { color: #888; margin-bottom: 20px; }
        #log { margin-top: 20px; font-size: 0.9em; color: #666; }
    </style>
</head>
<body>
    <h1>BPM测量工具</h1>
    <div id="info">请持续敲击任意键，窗口为10秒，每秒自动刷新BPM</div>
    <div id="bpm">BPM: --</div>
    <div id="log"></div>
    <script>
        let timestamps = [];
        const WINDOW = 10000; // ms
        const REFRESH = 500; // ms

        document.addEventListener('keydown', function(e) {
            const now = Date.now();
            timestamps.push(now);
        });

        function calcBPM() {
            const now = Date.now();
            // 只保留5秒窗口内的按键
            timestamps = timestamps.filter(ts => ts > now - WINDOW);
            const count = timestamps.length;
            // BPM = 60 * count / 5s
            const bpm = count > 1 ? Math.round(60 * count / (WINDOW / 1000)) : 0;
            document.getElementById('bpm').textContent = 'BPM: ' + bpm;
            document.getElementById('log').textContent = `最近10秒按键数：${count}`;
        }

        setInterval(calcBPM, REFRESH);
    </script>
</body>
</html>